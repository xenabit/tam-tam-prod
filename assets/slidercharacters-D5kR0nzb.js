var be=Object.defineProperty,_e=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var he=(g,t,d)=>t in g?be(g,t,{enumerable:!0,configurable:!0,writable:!0,value:d}):g[t]=d,X=(g,t)=>{for(var d in t||(t={}))Ce.call(t,d)&&he(g,d,t[d]);if(pe)for(var d of pe(t))ve.call(t,d)&&he(g,d,t[d]);return g},H=(g,t)=>_e(g,we(t));import{r as a,g as c,j as i}from"./vendor-Czmxryr-.js";import{u as xe}from"./carousel-DHCuXbNI.js";const ye="/tam-tam-prod/assets/images/slider-character-front-1.png",ke="/tam-tam-prod/assets/images/slider-character-front-2.png",Se="/tam-tam-prod/assets/images/slider-character-front-3.png",Ee="/tam-tam-prod/assets/images/slider-character-front-1.avif",Ie="/tam-tam-prod/assets/images/slider-character-front-2.avif",Le="/tam-tam-prod/assets/images/slider-character-front-3.avif",je="/tam-tam-prod/assets/images/slider-character-front-1.webp",Re="/tam-tam-prod/assets/images/slider-character-front-2.webp",Te="/tam-tam-prod/assets/images/slider-character-front-3.webp",Me="/tam-tam-prod/assets/images/slider-character-rotated-1.png",Ne="/tam-tam-prod/assets/images/slider-character-rotated-2.png",$e="/tam-tam-prod/assets/images/slider-character-rotated-3.png",Pe="/tam-tam-prod/assets/images/slider-character-rotated-1.avif",Be="/tam-tam-prod/assets/images/slider-character-rotated-2.avif",De="/tam-tam-prod/assets/images/slider-character-rotated-3.avif",ze="/tam-tam-prod/assets/images/slider-character-rotated-1.webp",Oe="/tam-tam-prod/assets/images/slider-character-rotated-2.webp",Ue="/tam-tam-prod/assets/images/slider-character-rotated-3.webp",qe=({id:g,isActive:t})=>{const[d,F]=a.useState(0),[p,x]=a.useState(!1),[m,G]=a.useState(!1),[N,se]=a.useState({animalBg:"#80dcb0",nameBg:"#2ea56c"}),I=a.useRef(null),q=a.useRef(null),$=a.useRef([]),y=a.useRef(null),Q=a.useRef([]),ne=a.useRef([]),{updateSliderlSlide:P}=xe(),L=a.useRef(null),f=a.useRef(!1),J=a.useRef(!1),j=a.useRef(!1),B=a.useRef(0),V=a.useRef(!1),R=a.useRef(!1),S=a.useRef(null),K=a.useMemo(()=>[{background:"#39C883",fill:"#2EA56C",outline:"#FCCD67",backgroundBox:"#80dcb0",backgroundName:"#2ea56c"},{background:"#5b71c1",fill:"#5b71c1",outline:"#ffd26e",backgroundBox:"#b7c6f4",backgroundName:"#849adc"},{background:"#ea437b",fill:"#c41650",outline:"#f49cba",backgroundBox:"#f49cba",backgroundName:"#c41650"}],[]),oe=a.useCallback(()=>{R.current||(console.log("Начало деактивации: плавное затемнение"),R.current=!0,c.to(I.current,{opacity:.3,duration:.3,ease:"power2.out",pointerEvents:"none",onComplete:()=>{console.log("Прозрачность уменьшена, начинаем сброс состояний"),S.current=setTimeout(()=>{W(),R.current=!1,V.current=!1,console.log("Деактивация завершена: состояния сброшены")},50)}}),x(!0))},[]),W=a.useCallback(()=>{console.log("Сброс состояния слайдера"),c.killTweensOf($.current),c.killTweensOf(B),c.killTweensOf(q.current),c.killTweensOf(L.current),y.current&&(y.current.kill(),y.current=null),Q.current.forEach(e=>{e&&(e.innerHTML="")}),S.current&&(clearTimeout(S.current),S.current=null),F(0),x(!1),G(!1),se({animalBg:"#80dcb0",nameBg:"#2ea56c"}),f.current=!1,J.current=!1,j.current=!1,B.current=0,R.current=!1,$.current.forEach((e,r)=>{e&&(c.set(e,{x:0,y:0,rotate:0,zIndex:100,opacity:1}),e.classList.remove("center","prev","next"),e.classList.add(Z(r)))}),L.current&&c.set(L.current,{opacity:1,clearProps:"all"}),I.current&&c.set(I.current,{opacity:1,pointerEvents:"auto",clearProps:"all"})},[]),Z=a.useCallback(e=>e===7?"center":e>6||e===0?"next":"prev",[]),ce=a.useCallback(e=>{if(!t)return;const r=ne.current[e];r&&(c.killTweensOf(r),c.fromTo(r,{scale:1},{scale:1.1,duration:.8,ease:"elastic.out(1, 0.3)",delay:.1}))},[t]),le=a.useCallback(e=>{if(!t)return;const r=Q.current[e];if(!r)return;r.innerHTML="";const s=24,n=100,o=600,l=Math.PI*(3-Math.sqrt(5)),w=c.timeline({onComplete:()=>{r.innerHTML=""}});for(let b=0;b<s;b++){const v=document.createElement("div");v.className="SliderCharacters__star-particle";const M=b%2===0,E=M?52:17,k=b*l,u=b/s,U=n+u*(o-n),te=.6+Math.random()*.4;v.style.cssText=`
        position: absolute;
        left: 50%;
        top: 50%;
        width: ${E}px;
        height: ${E}px;
        margin-left: -${E/2}px;
        margin-top: -${E/2}px;
        opacity: 0;
        transform: scale(0.3);
        will-change: transform, opacity;
        filter: drop-shadow(0 0 20px #ffbe2d) drop-shadow(0 0 80px #ffbe2d);
        pointer-events: none;
        z-index: 1000;
      `,r.appendChild(v);const me=U+(Math.random()-.5)*(U*.3),re=Math.cos(k)*me,ae=Math.sin(k)*me,ge=c.timeline({defaults:{ease:"linear"}});ge.to(v,{opacity:1,scale:M?1.1:1.4,x:re*.5,y:ae*.5,duration:te*.4}).to(v,{opacity:.8,scale:M?1:1.2,x:re*.7,y:ae*.7,duration:te*.2},"-=0.1").to(v,{opacity:0,scale:0,x:re,y:ae,duration:te*.4}),w.add(ge,0)}const C=setTimeout(()=>{r&&(r.innerHTML="")},3e3);return()=>{w.kill(),clearTimeout(C),r&&(r.innerHTML="")}},[t]),ie=a.useCallback((e,r="slider-character")=>({id:e,name:["Бони","Барсик","Лили"][(e-1)%3],image:{front:{img:new URL(Object.assign({"/src/assets/images/slider-character-front-1.png":ye,"/src/assets/images/slider-character-front-2.png":ke,"/src/assets/images/slider-character-front-3.png":Se})[`/src/assets/images/${r}-front-${e}.png`],import.meta.url).href,avif:new URL(Object.assign({"/src/assets/images/slider-character-front-1.avif":Ee,"/src/assets/images/slider-character-front-2.avif":Ie,"/src/assets/images/slider-character-front-3.avif":Le})[`/src/assets/images/${r}-front-${e}.avif`],import.meta.url).href,webp:new URL(Object.assign({"/src/assets/images/slider-character-front-1.webp":je,"/src/assets/images/slider-character-front-2.webp":Re,"/src/assets/images/slider-character-front-3.webp":Te})[`/src/assets/images/${r}-front-${e}.webp`],import.meta.url).href},rotated:{img:new URL(Object.assign({"/src/assets/images/slider-character-rotated-1.png":Me,"/src/assets/images/slider-character-rotated-2.png":Ne,"/src/assets/images/slider-character-rotated-3.png":$e})[`/src/assets/images/${r}-rotated-${e}.png`],import.meta.url).href,avif:new URL(Object.assign({"/src/assets/images/slider-character-rotated-1.avif":Pe,"/src/assets/images/slider-character-rotated-2.avif":Be,"/src/assets/images/slider-character-rotated-3.avif":De})[`/src/assets/images/${r}-rotated-${e}.avif`],import.meta.url).href,webp:new URL(Object.assign({"/src/assets/images/slider-character-rotated-1.webp":ze,"/src/assets/images/slider-character-rotated-2.webp":Oe,"/src/assets/images/slider-character-rotated-3.webp":Ue})[`/src/assets/images/${r}-rotated-${e}.webp`],import.meta.url).href}},alt:`Character ${e}`}),[]),h=a.useMemo(()=>{const e=[1,2,3].map(s=>ie(s));return[...e.map((s,n)=>H(X({},s),{id:n+1})),...e.map((s,n)=>H(X({},s),{id:n+4})),...e.map((s,n)=>H(X({},s),{id:n+7}))].map((s,n)=>H(X({},s),{initialClass:Z(n)}))},[ie,Z]),T=a.useMemo(()=>({radius:600,amplitude:90,spacing:400,visibleCount:8,rotate:16}),[]),ue=a.useCallback((e,r=0)=>{const s=h.length,o=(e-r+s)%s-Math.floor(T.visibleCount/2),l=o*T.spacing,w=l*l/(4*T.radius)+T.amplitude,C=o*T.rotate,b=Math.abs(o);return{x:l,y:w,rotation:C,zIndex:Math.round(100-b*10)}},[h.length,T]),D=a.useCallback((e=d,r=!1)=>{if(!t)return;const s=h.length,n=4;$.current.forEach((o,l)=>{if(!o)return;const w=o.classList.contains("center");o.classList.remove("center","prev","next");let C=(l-e+s)%s;C===n?(o.classList.add("center"),r&&(!w||r==="force")&&(le(l),ce(l))):C>n?o.classList.add("next"):o.classList.add("prev")})},[d,h.length,le,ce,t]),A=a.useCallback(e=>{t&&(se({animalBg:e.backgroundBox,nameBg:e.backgroundName}),c.to(document.documentElement,{duration:.6,ease:"linear","--current-animal-bg":e.backgroundBox,"--current-name-bg":e.backgroundName}))},[t]),_=a.useCallback((e=0,r=!1,s=!1)=>{t&&(e!==void 0&&(B.current=e),$.current.forEach((n,o)=>{if(!n)return;const l=ue(o,e);r||s?c.set(n,{x:l.x,y:l.y,rotate:l.rotation,zIndex:l.zIndex}):c.to(n,{duration:s?0:1,ease:s?"none":"linear",x:l.x,y:l.y,rotate:l.rotation,zIndex:l.zIndex,overwrite:!0})}))},[ue,t]),de=a.useCallback(()=>{if(!t||f.current||!J.current||j.current)return;j.current=!0,console.log("Запуск introAnimation для активного слайдера"),y.current&&y.current.kill(),G(!0),x(!0),_(0,!0);const e=c.timeline({onStart:()=>{console.log("Начало вступительной анимации"),c.to(I.current,{opacity:1,duration:.3,ease:"power2.out",pointerEvents:"auto"}),c.to(L.current,{opacity:1,duration:1.5,ease:"linear"})},onUpdate:()=>{t&&_(B.current,!1,!0)},onComplete:()=>{console.log("Анимация прокрутки завершена"),t&&(_(3,!0),c.delayedCall(.1,()=>{D(3,"force"),P(0),F(3);const s=K[0];A(s),c.delayedCall(.5,()=>{G(!1),x(!1),f.current=!0,j.current=!1,console.log("Вступительная анимация полностью завершена")})}))}});return c.set(L.current,{opacity:0}),e.to(B,{current:3,duration:1.2,ease:"power2.out",onUpdate:function(){t&&_(this.targets()[0].current,!1,!0)}}),y.current=e,()=>{y.current&&y.current.kill(),j.current=!1}},[t,K]),Y=a.useCallback((e,r="down")=>{if(!t||!q.current)return;const s=e%3,n=K[s],o=q.current;o.style.setProperty("--next-bg-color",n.background),o.style.setProperty("--gradient-direction",r==="down"?"to bottom":"to top"),o.style.setProperty("--bg-progress","0%"),c.fromTo(o,{"--bg-progress":"0%"},{"--bg-progress":"100%",duration:.6,ease:"linear",onComplete:()=>{o&&t&&(o.style.setProperty("--current-bg-color",n.background),o.style.setProperty("--bg-progress","0%"))}}),A(n)},[K,A,t]),z=a.useCallback(()=>{if(!t||p||m||!f.current)return;x(!0);const e=(d+1)%h.length,r=e%3;_(e),Y(r,"down"),c.delayedCall(.6,()=>{t&&(F(e),P(r),D(e,!0),x(!1))})},[t,p,m,d,h.length,_,Y,P,D,f]),O=a.useCallback(()=>{if(!t||p||m||!f.current)return;x(!0);const e=(d-1+h.length)%h.length,r=e%3;_(e),Y(r,"up"),c.delayedCall(.6,()=>{t&&(F(e),P(r),D(e,!0),x(!1))})},[t,p,m,d,h.length,_,Y,P,D,f]),ee=a.useCallback(e=>{!t||m||p||!f.current||(e.key==="ArrowRight"?(e.preventDefault(),z()):e.key==="ArrowLeft"&&(e.preventDefault(),O()))},[t,z,O,m,p,f]),fe=a.useCallback(()=>{if(!t||m||p||!f.current)return;let e=0,r=!1;const s=50,n=u=>{e=u,r=!0},o=u=>{if(!r)return;const U=u-e;Math.abs(U)>s&&(U>0?O():z(),r=!1)},l=()=>{r=!1},w=u=>{u.preventDefault(),n(u.clientX)},C=u=>{o(u.clientX)},b=()=>{l()},v=u=>{u.touches.length===1&&(u.preventDefault(),n(u.touches[0].clientX))},M=u=>{u.touches.length!==1||!r||(u.preventDefault(),o(u.touches[0].clientX))},E=u=>{u.touches.length>0||l()},k=I.current;if(k)return k.addEventListener("mousedown",w,{passive:!1}),k.addEventListener("touchstart",v,{passive:!1}),window.addEventListener("mousemove",C,{passive:!1}),window.addEventListener("touchmove",M,{passive:!1}),window.addEventListener("mouseup",b),window.addEventListener("touchend",E),()=>{k.removeEventListener("mousedown",w),k.removeEventListener("touchstart",v),window.removeEventListener("mousemove",C),window.removeEventListener("touchmove",M),window.removeEventListener("mouseup",b),window.removeEventListener("touchend",E)}},[t,z,O,m,p,f]);return a.useEffect(()=>(J.current||(console.log("Инициализация позиций слайдера"),_(0,!0),J.current=!0),t&&!f.current&&!j.current&&(console.log("Активация слайдера, запуск анимации"),S.current&&(clearTimeout(S.current),S.current=null),R.current=!1,de(),V.current=!0),!t&&V.current&&!R.current&&(console.log("Начинаем процесс деактивации"),oe()),()=>{t||W()}),[t,de,W,oe]),a.useEffect(()=>(window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)),[ee]),a.useEffect(()=>typeof window=="undefined"?void 0:fe(),[fe]),a.useEffect(()=>()=>{W()},[]),a.useEffect(()=>{document.documentElement.style.setProperty("--current-animal-bg",N.animalBg),document.documentElement.style.setProperty("--current-name-bg",N.nameBg)},[N]),i.jsxs("div",{className:"SliderCharacters",ref:I,id:g,style:{opacity:0},children:[i.jsx("div",{ref:q,className:"SliderCharacters__background","aria-hidden":"true"}),i.jsx("div",{ref:L,className:"SliderCharacters__container",children:h.map((e,r)=>i.jsxs("div",{ref:s=>$.current[r]=s,className:`SliderCharacters__item ${e.initialClass}`,style:{position:"absolute",cursor:m||!t?"default":"grab",pointerEvents:m||!t?"none":"auto"},children:[i.jsx("div",{ref:s=>Q.current[r]=s,className:"SliderCharacters__stars-explosion","aria-hidden":"true"}),i.jsxs("div",{className:"SliderCharacters__animal",children:[i.jsxs("div",{className:"SliderCharacters__pictures",children:[i.jsx("div",{className:"SliderCharacters__front",children:i.jsxs("picture",{children:[i.jsx("source",{type:"image/avif",srcSet:e.image.front.avif}),i.jsx("source",{type:"image/webp",srcSet:e.image.front.webp}),i.jsx("img",{ref:s=>ne.current[r]=s,src:e.image.front.img,width:"395",height:"395",alt:e.name,loading:r<3?"eager":"lazy",decoding:"async",style:{transformOrigin:"center bottom",display:"block",width:"100%",height:"110%",objectFit:"contain",objectPosition:"0 100%"}})]})}),i.jsx("div",{className:"SliderCharacters__rotated","aria-hidden":"true",children:i.jsxs("picture",{children:[i.jsx("source",{type:"image/avif",srcSet:e.image.rotated.avif}),i.jsx("source",{type:"image/webp",srcSet:e.image.rotated.webp}),i.jsx("img",{src:e.image.rotated.img,width:"395",height:"395",alt:e.alt,loading:"lazy",decoding:"async",draggable:"false"})]})})]}),i.jsx("div",{className:"SliderCharacters__name",children:e.name})]})]},`${e.id}-${r}`))}),i.jsxs("div",{className:"SliderCharacters__navigation",style:{opacity:m||!t?.3:1,pointerEvents:m||!t||!f.current?"none":"auto"},children:[i.jsx("button",{className:"SliderCharacters__arrow SliderCharacters__arrow_prev",onClick:O,"aria-label":"Previous slide",disabled:m||p||!t||!f.current,style:{backgroundColor:N.nameBg},children:"←"}),i.jsx("button",{className:"SliderCharacters__arrow SliderCharacters__arrow_next",onClick:z,"aria-label":"Next slide",disabled:m||p||!t||!f.current,style:{backgroundColor:N.nameBg},children:"→"})]})]})};export{qe as S};
